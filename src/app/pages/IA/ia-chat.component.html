<div class="container mt-4">
  <div class="ia-chat-container">
    <div class="chat-header">
      <h2>🤖 Inteligência Artificial - Perícia Criminal </h2>
    </div>

    <!-- SELEÇÃO DE TIPO DE LAUDO -->
    <div class="chat-inicio" *ngIf="!chatIniciado">
      <div class="card p-4">
        <h3 class="text-center mb-4">Escolha o assunto do trabalho:</h3>

        <select [(ngModel)]="tipoLaudo" class="form-control form-control-lg mb-3">
          <option *ngFor="let tipo of tiposLaudo" [value]="tipo">
            {{ tipo }}
          </option>
        </select>

        <button
          class="btn btn-primary btn-lg btn-block w-100"
          (click)="iniciarChat()"
          [disabled]="carregando">
          <span *ngIf="!carregando">🚀 Iniciar Chat</span>
          <span *ngIf="carregando">⏳ Carregando...</span>
        </button>
      </div>
    </div>

    <!-- CHAT ATIVO -->
    <div class="chat-ativo" *ngIf="chatIniciado">

      <!-- MENSAGENS -->
      <div class="chat-mensagens">
        <div
          *ngFor="let msg of mensagens"
          [ngClass]="'mensagem mensagem-' + msg.tipo">

          <div class="mensagem-avatar">
            <span *ngIf="msg.tipo === 'ia'">🤖</span>
            <span *ngIf="msg.tipo === 'user'">👤</span>
          </div>

          <div class="mensagem-conteudo">
            <div class="mensagem-texto">{{ msg.conteudo }}</div>
            <div class="mensagem-hora">
              {{ msg.timestamp | date:'HH:mm' }}
            </div>
          </div>
        </div>

        <div *ngIf="carregando" class="mensagem mensagem-ia">
          <div class="mensagem-avatar">🤖</div>
          <div class="mensagem-conteudo">
            <div class="typing-indicator">
              <span></span><span></span><span></span>
            </div>
          </div>
        </div>
      </div>

      <!-- INPUT E BOTÕES -->
      <div class="chat-input">
        <textarea
          [(ngModel)]="mensagemAtual"
          (keydown)="onEnter($event)"
          placeholder="Digite sua mensagem..."
          class="form-control mb-2"
          rows="2"
          [disabled]="carregando"></textarea>

        <div class="chat-botoes">
          <button
            class="btn btn-success"
            (click)="enviarMensagem()"
            [disabled]="!mensagemAtual.trim() || carregando">
            📤 Enviar
          </button>

          <button
            class="btn btn-primary"
            (click)="gerarLaudoFinal()"
            [disabled]="carregando">
            📄 Gerar Laudo
          </button>

          <button
            class="btn btn-info"
            (click)="baixarPdf()"
            [disabled]="!laudoGerado || carregando">
            📥 Baixar PDF
          </button>

          <button
            class="btn btn-secondary"
            (click)="reiniciarChat()">
            🔄 Novo Chat
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
