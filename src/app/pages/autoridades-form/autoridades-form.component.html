<div class="container">
  <div class="header-actions">
    <button class="btn-back" (click)="cancelar()">
      <i class="bi bi-arrow-left"></i> Voltar
    </button>
    <h1>{{ isEditMode ? 'Editar Autoridade' : 'Nova Autoridade' }}</h1>
  </div>

  @if (isLoading || isLoadingCargos) {
    <div class="loading">
      <i class="bi bi-hourglass-split"></i>
      <p>Carregando dados...</p>
    </div>
  }

  @if (message) {
    <div class="message" [ngClass]="{'success': messageType === 'success', 'error': messageType === 'error'}">
      {{ message }}
    </div>
  }

  @if (!isLoading && !isLoadingCargos) {
    <div class="form-container">
      <form [formGroup]="form" (ngSubmit)="onSubmit()">
        <div class="form-group">
          <label for="nome">
            <i class="bi bi-person-badge"></i>
            Nome da Autoridade *
          </label>
          <input
            type="text"
            id="nome"
            formControlName="nome"
            class="form-control"
            placeholder="Ex: JOSÉ DA SILVA SANTOS"
            maxlength="255"
            [class.error]="nome?.invalid && nome?.touched"
          >
          @if (nome?.invalid && nome?.touched) {
            <div class="error-message">
              @if (nome?.errors?.['required']) {
                <span>O nome da autoridade é obrigatório.</span>
              }
              @if (nome?.errors?.['maxlength']) {
                <span>O nome deve ter no máximo 255 caracteres.</span>
              }
            </div>
          }
          <small class="hint">Será convertido automaticamente para maiúsculas</small>
        </div>

        <div class="form-group">
          <label for="cargo_id">
            <i class="bi bi-briefcase"></i>
            Cargo *
          </label>
          <select
            id="cargo_id"
            formControlName="cargo_id"
            class="form-control"
            [class.error]="cargo_id?.invalid && cargo_id?.touched"
          >
            <option value="">Selecione um cargo</option>
            @for (cargo of cargos; track cargo.id) {
              <option [value]="cargo.id">{{ cargo.nome }}</option>
            }
          </select>
          @if (cargo_id?.invalid && cargo_id?.touched) {
            <div class="error-message">
              <span>Selecione um cargo.</span>
            </div>
          }
          <small class="hint">Cargo ocupado pela autoridade</small>
        </div>

        <div class="form-actions">
          <button type="button" class="btn-secondary" (click)="cancelar()" [disabled]="isSaving">
            <i class="bi bi-x-circle"></i>
            Cancelar
          </button>
          <button type="submit" class="btn-primary" [disabled]="form.invalid || isSaving">
            <i class="bi bi-check-circle"></i>
            {{ isSaving ? 'Salvando...' : (isEditMode ? 'Atualizar' : 'Cadastrar') }}
          </button>
        </div>
      </form>
    </div>
  }
</div>
