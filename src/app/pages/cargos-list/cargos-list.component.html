<div class="container">
  <div class="header-row">
    <div>
      <h1>Gerenciamento de Cargos</h1>
      <p class="subtitle">Cadastre e gerencie os cargos do sistema.</p>
    </div>

    <div class="actions-header">
      <button class="btn-primary" (click)="onCreate()">
        <i class="bi bi-plus-circle"></i>
        Novo Cargo
      </button>
    </div>
  </div>

  <div class="tabs">
    <button
      class="tab"
      [class.active]="viewMode === 'ativos'"
      (click)="switchToAtivos()">
      <i class="bi bi-list-ul"></i>
      Ativos
    </button>
    @if (isSuperAdmin) {
      <button
        class="tab"
        [class.active]="viewMode === 'lixeira'"
        (click)="switchToLixeira()">
        <i class="bi bi-trash"></i>
        Lixeira
      </button>
    }
  </div>

  @if (viewMode === 'ativos') {
    <div class="search-container">
      <i class="bi bi-search"></i>
      <input
        type="text"
        [(ngModel)]="searchTerm"
        (keyup.enter)="onSearch()"
        placeholder="Buscar por nome... (pressione Enter)"
        class="search-input"
      >
      @if (searchTerm) {
        <button class="clear-search" (click)="clearSearch()">
          <i class="bi bi-x-circle"></i>
        </button>
      }
      <button class="btn-search" (click)="onSearch()">
        Buscar
      </button>
    </div>
  }

  @if (viewMode === 'lixeira') {
    <div class="search-container">
      <i class="bi bi-search"></i>
      <input
        type="text"
        [(ngModel)]="searchTerm"
        placeholder="Filtrar por nome..."
        class="search-input"
      >
      @if (searchTerm) {
        <button class="clear-search" (click)="searchTerm = ''">
          <i class="bi bi-x-circle"></i>
        </button>
      }
    </div>
  }

  @if (message) {
    <div class="message" [ngClass]="{'success': messageType === 'success', 'error': messageType === 'error'}">
      {{ message }}
    </div>
  }

  @if (viewMode === 'ativos') {
    @if (isLoading) {
      <div class="loading-indicator">
        <i class="bi bi-hourglass-split"></i>
        <p>Carregando cargos...</p>
      </div>
    }

    @if (!isLoading && cargos.length > 0) {
      <div class="table-container">
        <table class="data-table">
          <thead>
            <tr>
              <th>Nome</th>
              <th>Cadastrado em</th>
              <th>Cadastrado por</th>
              <th>Atualizado em</th>
              <th>Atualizado por</th>
              <th class="actions-header">Ações</th>
            </tr>
          </thead>
          <tbody>
            @for (cargo of cargos; track cargo.id) {
              <tr>
                <td data-label="Nome" class="nome-cell">{{ cargo.nome }}</td>
                <td data-label="Cadastrado em">{{ cargo.created_at | date:'dd/MM/yyyy' }}</td>
                <td data-label="Cadastrado por">{{ getFirstName(cargo.created_by?.nome_completo) }}</td>
                <td data-label="Atualizado em">{{ cargo.updated_at | date:'dd/MM/yyyy HH:mm' }}</td>
                <td data-label="Atualizado por">{{ getFirstName(cargo.updated_by?.nome_completo) }}</td>
                <td class="actions-cell" data-label="Ações">
                  <button class="icon-btn edit" title="Editar" (click)="onEdit(cargo.id)">
                    <i class="bi bi-pencil"></i>
                  </button>
                  @if (isSuperAdmin) {
                    <button class="icon-btn danger" title="Mover para Lixeira" (click)="onDelete(cargo)">
                      <i class="bi bi-trash"></i>
                    </button>
                  }
                </td>
              </tr>
            }
          </tbody>
        </table>

        <div class="pagination">
          <div class="page-info">
            Página {{ currentPage }} de {{ totalPages }} | Total: {{ totalCount }} cargos
          </div>
          <div class="pagination-controls">
            <button (click)="previousPage()" [disabled]="!previousUrl">
              <i class="bi bi-chevron-left"></i>
              Anterior
            </button>
            <button (click)="nextPage()" [disabled]="!nextUrl">
              Próxima
              <i class="bi bi-chevron-right"></i>
            </button>
          </div>
        </div>
      </div>
    }

    @if (!isLoading && cargos.length === 0) {
      <div class="empty-state">
        <i class="bi bi-inbox"></i>
        <p>{{ searchTerm ? 'Nenhum cargo encontrado' : 'Nenhum cargo cadastrado' }}</p>
      </div>
    }
  }

  @if (viewMode === 'lixeira') {
    @if (isLoadingLixeira) {
      <div class="loading-indicator">
        <i class="bi bi-hourglass-split"></i>
        <p>Carregando lixeira...</p>
      </div>
    }

    @if (!isLoadingLixeira && cargosLixeiraFiltrados.length > 0) {
      <div class="table-container">
        <table class="data-table">
          <thead>
            <tr>
              <th>Nome</th>
              <th>Deletado em</th>
              <th>Deletado por</th>
              <th class="actions-header">Ações</th>
            </tr>
          </thead>
          <tbody>
            @for (cargo of cargosLixeiraFiltrados; track cargo.id) {
              <tr>
                <td data-label="Nome" class="nome-cell deleted">{{ cargo.nome }}</td>
                <td data-label="Deletado em">{{ cargo.deleted_at | date:'dd/MM/yyyy HH:mm' }}</td>
                <td data-label="Deletado por">{{ cargo.deleted_by?.nome_completo || 'N/D' }}</td>
                <td class="actions-cell" data-label="Ações">
                  <button class="icon-btn restore" title="Restaurar" (click)="onRestore(cargo)">
                    <i class="bi bi-arrow-clockwise"></i>
                  </button>
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>
    }

    @if (!isLoadingLixeira && cargosLixeiraFiltrados.length === 0) {
      <div class="empty-state">
        <i class="bi bi-trash"></i>
        <p>{{ searchTerm ? 'Nenhum cargo encontrado' : 'A lixeira está vazia' }}</p>
      </div>
    }
  }
</div>
